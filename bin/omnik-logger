#!/usr/bin/env python

import argparse
from omnik import DataLoggerWifi, DataLoggerEth

def main(args):
  if args.network == 'wifi':
    url = "http://{0}:{1}/js/status.js".format(args.host, args.port)
    clazz = DataLoggerWifi(url=url, username=args.user, password=args.password, debug=args.debug)
    clazz.process(args)
  else:
    url = "http://{0}:{1}/status.json?CMD=inv_query".format(args.host, args.port)
    clazz = DataLoggerEth(url=url, debug=args.debug)
    clazz.process(args)
    
  

if __name__ == '__main__':
  parser = argparse.ArgumentParser()

  parser.add_argument('--network', default='eth', choices=['wifi','eth'], help='Type of network')
  parser.add_argument('--host', required=True, help='Omnik inverter ip address')
  parser.add_argument('--port', default='80', help='Port')
  parser.add_argument('-u', '--user', default='admin', help='Username')
  parser.add_argument('-p', '--password', default='admin', help='Password')
  parser.add_argument('-d', '--debug', action='store_true', help='Debug mode')

  args = parser.parse_args()
  main(args)